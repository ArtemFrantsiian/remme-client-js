var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).RemmeWebSocketEvents=e()}}(function(){return function r(i,c,a){function u(t,e){if(!c[t]){if(!i[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(p)return p(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var n=c[t]={exports:{}};i[t][0].call(n.exports,function(e){return u(i[t][1][e]||e)},n,n.exports,r,i,c,a)}return c[t].exports}for(var p="function"==typeof require&&require,e=0;e<a.length;e++)u(a[e]);return u}({1:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var o=e("remme-web-socket"),n=e("./models");s.RemmeEventsEntity=n.RemmeEventsEntity,s.RemmeEvents=n.RemmeEvents;var r=function(){function e(e,t){this._socketAddress=e,this._sslMode=t}return e.prototype._prepareEvents=function(e){return e="object"!==(void 0===e?"undefined":_typeof(e))?e===n.RemmeEvents.SwapAll?[n.RemmeEvents.SwapInit,n.RemmeEvents.SwapSetSecretLock,n.RemmeEvents.SwapApprove,n.RemmeEvents.SwapExpire,n.RemmeEvents.SwapClose]:[e]:e.filter(function(e){return e!==n.RemmeEvents.SwapAll})},e.prototype._generateData=function(e){var t=e.events,s=e.lastKnownBlockId;t=this._prepareEvents(t);var o=new n.RemmeEventsData;return o.entity=n.RemmeEventsEntity.Events,o.events=t,s&&(o.last_known_block_id=s),o},e.prototype.subscribe=function(e,t){var s=this._generateData(e);this._socket&&this._socket.closeWebSocket(),this._socket=new o.RemmeWebSocket(this._socketAddress,this._sslMode),this._socket.isEvent=!0,this._socket.data=s,this._socket.connectToWebSocket(t)},e.prototype.unsubscribe=function(){if(!this._socket)throw new Error("WebSocket is not running");this._socket.closeWebSocket(),this._socket=null},e}();s.RemmeWebSocketsEvents=r},{"./models":5,"remme-web-socket":6}],2:[function(e,t,s){"use strict";var o;Object.defineProperty(s,"__esModule",{value:!0}),(o=s.RemmeEvents||(s.RemmeEvents={})).SwapAll="atomic-swap-all",o.SwapInit="atomic-swap-init",o.SwapSetSecretLock="atomic-swap-set-secret-lock",o.SwapApprove="atomic-swap-approve",o.SwapExpire="atomic-swap-expire",o.SwapClose="atomic-swap-close"},{}],3:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var o=function(){};s.RemmeEventsData=o},{}],4:[function(e,t,s){"use strict";var o;Object.defineProperty(s,"__esModule",{value:!0}),(o=s.RemmeEventsEntity||(s.RemmeEventsEntity={})).Events="events",o.CatchUp="catch_up"},{}],5:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var o=e("./RemmeEvents");s.RemmeEvents=o.RemmeEvents;var n=e("./RemmeEventsEntity");s.RemmeEventsEntity=n.RemmeEventsEntity;var r=e("./RemmeEventsData");s.RemmeEventsData=r.RemmeEventsData},{"./RemmeEvents":2,"./RemmeEventsData":3,"./RemmeEventsEntity":4}],6:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n,o=e("websocket"),r=e("./models");s.Statuses=r.Statuses,n="undefined"!=typeof window&&"undefined"!==window.WebSocket?window.WebSocket:o.w3cwebsocket;var i=function(){function e(e,t){this.isEvent=!1,this.socketAddress=e,this.sslMode=t}return e.prototype.connectToWebSocket=function(s){var o=this;this._socket&&this.closeWebSocket(),this._socket=new n(this._getSubscribeUrl()),this._socket.onopen=function(){o._socket.send(o._getSocketQuery())},this._socket.onmessage=function(e){var t=JSON.parse(e.data);if("message"===t.type&&0!==Object.getOwnPropertyNames(t.data).length){if(t.data.batch_statuses&&t.data.batch_statuses.invalid_transactions&&t.data.batch_statuses.invalid_transactions.length)return void o._sendAnError(new r.ErrorMessage(t.data.batch_statuses.invalid_transactions[0]),s);s(null,o.isEvent?t.data:new r.BatchStatusesDto(t.data.batch_statuses))}else if("error"===t.type)return void o._sendAnError(new r.ErrorFromEvent(t.data),s)},this._socket.onerror=function(e){s(e)}},e.prototype.closeWebSocket=function(){if(!this._socket)throw new Error("WebSocket is not running");1===this._socket.readyState&&this._socket.send(this._getSocketQuery(!1)),this._socket.close(),this._socket=null},e.prototype._sendAnError=function(e,t){this.closeWebSocket(),t(e)},e.prototype._getSubscribeUrl=function(){return""+(this.sslMode?"wss://":"ws://")+this.socketAddress+"/ws"+(this.isEvent?"/events":"")},e.prototype._getSocketQuery=function(e){void 0===e&&(e=!0);var t=this.isEvent?{action:e?"subscribe":"unsubscribe",data:this.data}:{type:"request",action:e?"subscribe":"unsubscribe",entity:"batch_state",id:Math.floor(1e3*Math.random()),parameters:this.data};return JSON.stringify(t)},e}();s.RemmeWebSocket=i},{"./models":10,websocket:11}],7:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var o,n,r=function(e){this.status=o[e.status],this.batchId=e.batch_id};s.BatchStatusesDto=r,(n=o=s.Statuses||(s.Statuses={})).INVALID="INVALID",n.PENDING="PENDING",n.COMMITTED="COMMITTED"},{}],8:[function(e,t,o){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},function(e,t){function s(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)});Object.defineProperty(o,"__esModule",{value:!0});var s=function(s){function e(e){var t=s.call(this,e.info)||this;return t.status=o.StatusEvent[e.status],t}return r(e,s),e}(Error);o.ErrorFromEvent=s,o.StatusEvent={10:"SUBSCRIBED",11:"UNSUBSCRIBED",100:"MALFORMED_JSON",101:"MISSING_ACTION",102:"INVALID_ACTION",103:"MISSING_ID",104:"MISSING_PARAMETERS",105:"INVALID_PARAMS",106:"INVALID_ENTITY",107:"MISSING_ENTITY",108:"MESSAGE_ID_EXISTS",109:"MISSING_TYPE",110:"NO_VALIDATOR",111:"MISSING_DATA",112:"WRONG_EVENT_TYPE",113:"ALREADY_SUBSCRIBED",114:"EVENTS_NOT_PROVIDED",200:"BATCH_RESPONSE"}},{}],9:[function(e,t,s){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},function(e,t){function s(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var r=function(s){function e(e){var t=s.call(this,e.message)||this;return t.extendedData=e.extended_data,t.transactionId=e.transaction_id,t}return n(e,s),e}(Error);s.ErrorMessage=r},{}],10:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var o=e("./BatchStateUpdateDto");s.BatchStatusesDto=o.BatchStatusesDto,s.Statuses=o.Statuses;var n=e("./ErrorMessage");s.ErrorMessage=n.ErrorMessage;var r=e("./ErrorFromEvent");s.ErrorFromEvent=r.ErrorFromEvent},{"./BatchStateUpdateDto":7,"./ErrorFromEvent":8,"./ErrorMessage":9}],11:[function(e,t,s){var o=function(){return this}(),n=o.WebSocket||o.MozWebSocket,r=e("./version");function i(e,t){return t?new n(e,t):new n(e)}n&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(i,e,{get:function(){return n[e]}})}),t.exports={w3cwebsocket:n?i:null,version:r}},{"./version":12}],12:[function(e,t,s){t.exports=e("../package.json").version},{"../package.json":13}],13:[function(e,t,s){t.exports={_args:[["websocket@1.0.26","/var/www/remme-client-js/packages/remme-base-transaction-response"]],_from:"websocket@1.0.26",_id:"websocket@1.0.26",_inBundle:!1,_integrity:"sha512-fjcrYDPIQxpTnqFQ9JjxUQcdvR89MFAOjPBlF+vjOt49w/XW4fJknUoMz/mDIn2eK1AdslVojcaOxOqyZZV8rw==",_location:"/websocket",_phantomChildren:{ms:"2.0.0"},_requested:{type:"version",registry:!0,raw:"websocket@1.0.26",name:"websocket",escapedName:"websocket",rawSpec:"1.0.26",saveSpec:null,fetchSpec:"1.0.26"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.26.tgz",_spec:"1.0.26",_where:"/var/www/remme-client-js/packages/remme-base-transaction-response",author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},config:{verbose:!1},contributors:[{name:"IÃ±aki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{debug:"^2.2.0",nan:"^2.3.3","typedarray-to-buffer":"^3.1.2",yaeti:"^0.0.6"},description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.0.1"},directories:{lib:"./lib"},engines:{node:">=0.10.0"},homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",name:"websocket",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit"},version:"1.0.26"}},{}]},{},[1])(1)});
//# sourceMappingURL=remme-web-socket-events.min.js.map
